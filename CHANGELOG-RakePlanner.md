## Rake Planner Feature Set Summary

Date: 2025-10-14

### Backend
1. Unified automation endpoint `/workflow/auto-rake-plan` (consolidate -> allocate -> rake plan) with params:
   - wagonCapacity (default 60)
   - maxRakes (default 10)
   - minTonnage (destination batching threshold)
   - inventoryUtilThreshold (0..1 fraction; require available inventory >= threshold * order quantity for allocation)
2. Allocation heuristic chooses loading point by material match and highest available inventory; respects inventory utilization threshold.
3. Socket events emitted:
   - `order_status_changed` (ALLOCATED, PLANNED, DISPATCHED, threshold skip reason)
   - `rake_planned`
   - `rake_dispatched`
4. `/planner/rakes/status` enriched with wagons count, orders list, material, loadingPoint, customerName aggregation and planned cost.
5. `/workflow/rake-backlog` exposes destinations accumulating tonnage below minTonnage (ALLOCATED / CONSOLIDATED states).
6. Conditional server auto-start skipped when TEST or NODE_ENV=test; exports `{ app, httpServer }` for integration tests.

### Frontend (Next.js /manager/rake-planner)
1. Added columns: Destination, Material, Loading Point, Customer, Wagons, ETA, Status, Cost, Orders.
2. Parameter controls for wagon capacity, min tonnage, max rakes, inventory utilization %.
3. Parameter persistence via `localStorage` (`rakePlannerParams`).
4. Backlog panel rendering destinations still below threshold.
5. Socket listeners for `rake_planned`, `rake_dispatched`, `order_status_changed` with lightweight throttled refresh + polling fallback.

### Testing
1. Added Jest + Supertest harness under `apps/api/tests` with sample auth + auto-plan test.
2. Jest config (`jest.config.cjs`) and test script (`npm run -w apps/api test`).

### Next Ideas (Not Implemented Yet)
- Granular real-time in-row updates without full refresh.
- Tooltip expansion for multi-customer or multi-loading point rakes.
- Advanced cost & utilization analytics panel.

---
This file is auto-generated by development assistance to capture implemented scope; keep it updated with subsequent improvements.